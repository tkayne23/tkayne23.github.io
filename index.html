<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="leaflet-search-master\dist\leaflet-search.src.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src ="data\model_data.js"></script>
    <script src ="data\usa_tribe_data.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <title>JSK Photo Indigenous Models</title>

    <style>
    #map {position: absolute; top: 0; bottom: 0; left: 0; right: 0;}
    .popup-image {
        max-width: 100%;
        height: auto;
        display: block;
        border-radius: 6px;
        margin-top: 5px;
    }
    /* optional: style the popup container */
    .custom-popup .leaflet-popup-content {
        max-height: 300px;
        overflow-y: auto;   /* scroll if too tall */
    }

    /* Style for the instruction box */
    .info-box {
        padding: 10px 15px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
        color: #333;
        max-width: 250px;
    }

    .info-box h4 {
        margin: 0 0 5px;
        color: #777;
    }

    </style>


    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

    <div id="map"></div>

    <script>
        // Initialize the map
        var map = L.map('map').setView([41.379724, -100.415039], 4);
        // Add the initial default map; maps found at https://cloud.maptiler.com/maps/openstreetmap/
        var osm = L.tileLayer('https://api.maptiler.com/maps/openstreetmap/{z}/{x}/{y}.jpg?key=MUbdeXKoXqDp1iqwR989', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'
        }).addTo(map);

        // Create a custom control for instructions
        var instructions = L.control({position: 'bottomleft'});

        instructions.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info-box'); 
            div.innerHTML = '<h4>Map Instructions</h4>' +
                            '<ul>' +
                            '<li><b>Click</b> markers to view photos.</li>' +
                            '<li><b>Hover</b> over pink areas to see tribal land names.</li>' +
                            '<li>Use the <b>layers icon</b> (top right) to toggle data.</li>' +
                            '<li>Use the <b>search icon</b> (top right) to find destinations.</li>' +
                            '</ul>';
            return div;
        };

        instructions.addTo(map);


        // add geocoder search
        new L.Control.Geocoder().addTo(map);

        // add watermark for logo
        L.Control.Watermark=L.Control.extend({
            onAdd:function(map){
                var img = L.DomUtil.create('img');
                img.src = 'JSK_logo.png';
                img.style.width = '200px';
                return img;
                },
                onRemove:function(map){},
                });
                L.control.watermark = function(opts){
                    return new L.Control.Watermark(opts);
                    }
                L.control.watermark({position:'bottomleft'}).addTo(map);

        // add additional basemaps
        var Satellite_hybrid = L.tileLayer('Https://api.maptiler.com/maps/hybrid-v4/{z}/{x}/{y}.jpg?key=MUbdeXKoXqDp1iqwR989', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
        });

        var Topo = L.tileLayer('https://api.maptiler.com/maps/topo-v4/{z}/{x}/{y}.png?key=MUbdeXKoXqDp1iqwR989', {
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
        });

        //Leaflet basemaps layer control
        var baseMaps = {
            'Opens Street Map': osm,
            'Satellite Hybrid': Satellite_hybrid,
            'Topo': Topo
        }

        var model_data = L.geoJSON(model_data, {
            onEachFeature: function(feature, layer) {
                var props = feature.properties;
                var name = props.name || 'Unknown';
                // Remove leading whitespace for valid URL
                var imageUrl = props.html_link ? props.html_link.trim() : null;

                var popupContent = '<b>' + name + '</b>';
                if (imageUrl) {
                    popupContent += '<br><img src="' + imageUrl + '" class="popup-image" alt="' + name + '">';
                }

                layer.bindPopup(popupContent, {
                    maxWidth: 400,
                    className: 'custom-popup'
                });

                // Resize popup after image loads
                layer.on('popupopen', function(e) {
                    var img = e.popup._contentNode.querySelector('img');
                    if (img) {
                        img.onload = function() {
                            e.popup.update();
                        };
                    }
                });
            }
        }).addTo(map);

        // Add geojson data from external file with style and hover effects
        var usa_tribe_data = L.geoJSON(usa_tribe_data, {
            style: function(feature) {
                return {
                    color: 'pink',       // Outline color
                    fillColor: 'pink',   // Fill color
                    fillOpacity: 0.55,    // Opacity set to .5
                    weight: 2            // Outline thickness
                };
            },
            onEachFeature: function(feature, layer) {
                // Display AreaName when hovering
                if (feature.properties && feature.properties.AreaName) {
                    layer.bindTooltip(feature.properties.AreaName, {
                        sticky: true // Tooltip follows the mouse
                    });
                }
            }
        }).addTo(map);
    
        // checkbox overlay map goes here
        var overlayMaps = {
            'Indigenous Models': model_data,
            'USA Tribal Land': usa_tribe_data
        }

        L.control.layers(baseMaps, overlayMaps).addTo(map);


    </script>

</body>
</html>
